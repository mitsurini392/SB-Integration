!function(e){function t(t,n){function r(){clearTimeout(A),A=!1,O=!1}function i(t,n){var r,i,s;return t.preventDefault(),r=e(t.target).offset(),clearTimeout(A),A=!1,"undefined"!=typeof t.targetTouches?(i=Math.floor(t.targetTouches[0].pageX-r.left),s=Math.floor(t.targetTouches[0].pageY-r.top)):(i=Math.floor(t.pageX-r.left),s=Math.floor(t.pageY-r.top)),k.x===i&&k.y===s?!0:(null===k.x&&(k.x=i),null===k.y&&(k.y=s),n&&(s+=n),C.beginPath(),C.moveTo(k.x,k.y),C.lineTo(i,s),C.lineCap=S.penCap,C.stroke(),C.closePath(),L.push({lx:i,ly:s,mx:k.x,my:k.y}),k.x=i,k.y=s,S.onDraw&&"function"==typeof S.onDraw&&S.onDraw.apply(E),void 0)}function s(){o()}function o(t){t?i(t,1):(M?T.each(function(){this.removeEventListener("touchmove",i)}):T.unbind("mousemove.signaturepad"),L.length>0&&S.onDrawEnd&&"function"==typeof S.onDrawEnd&&S.onDrawEnd.apply(E)),k.x=null,k.y=null,S.output&&L.length>0&&e(S.output,x).val(JSON.stringify(L))}function u(){return S.lineWidth?(C.beginPath(),C.lineWidth=S.lineWidth,C.strokeStyle=S.lineColour,C.moveTo(S.lineMargin,S.lineTop),C.lineTo(N.width-S.lineMargin,S.lineTop),C.stroke(),C.closePath(),void 0):!1}function a(){C.clearRect(0,0,N.width,N.height),C.fillStyle=S.bgColour,C.fillRect(0,0,N.width,N.height),S.displayOnly||u(),C.lineWidth=S.penWidth,C.strokeStyle=S.penColour,e(S.output,x).val(""),L=[],o()}function f(e,t){null==k.x?i(e,1):i(e,t)}function l(e,t){M?t.addEventListener("touchmove",f,!1):T.bind("mousemove.signaturepad",f),i(e,1)}function c(){_=!1,T.each(function(){this.removeEventListener&&(this.removeEventListener("touchend",s),this.removeEventListener("touchcancel",s),this.removeEventListener("touchmove",i)),this.ontouchstart&&(this.ontouchstart=null)}),e(document).unbind("mouseup.signaturepad"),T.unbind("mousedown.signaturepad"),T.unbind("mousemove.signaturepad"),T.unbind("mouseleave.signaturepad"),e(S.clear,x).unbind("click.signaturepad")}function h(t){return _?!1:(_=!0,e("input").blur(),"undefined"!=typeof t.targetTouches&&(M=!0),M?(T.each(function(){this.addEventListener("touchend",s,!1),this.addEventListener("touchcancel",s,!1)}),T.unbind("mousedown.signaturepad")):(e(document).bind("mouseup.signaturepad",function(){O&&(o(),r())}),T.bind("mouseleave.signaturepad",function(e){O&&o(e),O&&!A&&(A=setTimeout(function(){o(),r()},500))}),T.each(function(){this.ontouchstart=null})),void 0)}function p(){e(S.typed,x).hide(),a(),T.each(function(){this.ontouchstart=function(e){e.preventDefault(),O=!0,h(e),l(e,this)}}),T.bind("mousedown.signaturepad",function(e){return e.preventDefault(),e.which>1?!1:(O=!0,h(e),l(e),void 0)}),e(S.clear,x).bind("click.signaturepad",function(e){e.preventDefault(),a()}),e(S.typeIt,x).bind("click.signaturepad",function(e){e.preventDefault(),d()}),e(S.drawIt,x).unbind("click.signaturepad"),e(S.drawIt,x).bind("click.signaturepad",function(e){e.preventDefault()}),e(S.typeIt,x).removeClass(S.currentClass),e(S.drawIt,x).addClass(S.currentClass),e(S.sig,x).addClass(S.currentClass),e(S.typeItDesc,x).hide(),e(S.drawItDesc,x).show(),e(S.clear,x).show()}function d(){a(),c(),e(S.typed,x).show(),e(S.drawIt,x).bind("click.signaturepad",function(e){e.preventDefault(),p()}),e(S.typeIt,x).unbind("click.signaturepad"),e(S.typeIt,x).bind("click.signaturepad",function(e){e.preventDefault()}),e(S.output,x).val(""),e(S.drawIt,x).removeClass(S.currentClass),e(S.typeIt,x).addClass(S.currentClass),e(S.sig,x).removeClass(S.currentClass),e(S.drawItDesc,x).hide(),e(S.clear,x).hide(),e(S.typeItDesc,x).show(),P=D=e(S.typed,x).css("font-size").replace(/px/,"")}function v(t){var n=e(S.typed,x),r=e.trim(t.replace(/>/g,"&gt;").replace(/</g,"&lt;")),i=H,s=.5*P;if(H=r.length,n.html(r),!r)return n.css("font-size",D+"px"),void 0;if(H>i&&n.outerWidth()>N.width)for(;n.outerWidth()>N.width;)P--,n.css("font-size",P+"px");if(i>H&&n.outerWidth()+s<N.width&&D>P)for(;n.outerWidth()+s<N.width&&D>P;)P++,n.css("font-size",P+"px")}function m(t,n){e("p."+n.errorClass,t).remove(),t.removeClass(n.errorClass),e("input, label",t).removeClass(n.errorClass)}function g(t,n,r){t.nameInvalid&&(n.prepend(['<p class="',r.errorClass,'">',r.errorMessage,"</p>"].join("")),e(r.name,n).focus(),e(r.name,n).addClass(r.errorClass),e("label[for="+e(r.name).attr("id")+"]",n).addClass(r.errorClass)),t.drawInvalid&&n.prepend(['<p class="',r.errorClass,'">',r.errorMessageDraw,"</p>"].join(""))}function y(){var t=!0,n={drawInvalid:!1,nameInvalid:!1},r=[x,S],i=[n,x,S];return S.onBeforeValidate&&"function"==typeof S.onBeforeValidate?S.onBeforeValidate.apply(E,r):m.apply(E,r),S.drawOnly&&L.length<1&&(n.drawInvalid=!0,t=!1),""===e(S.name,x).val()&&(n.nameInvalid=!0,t=!1),S.onFormError&&"function"==typeof S.onFormError?S.onFormError.apply(E,i):g.apply(E,i),t}function b(e,t,n){for(var r in e)"object"==typeof e[r]&&(t.beginPath(),t.moveTo(e[r].mx,e[r].my),t.lineTo(e[r].lx,e[r].ly),t.lineCap=S.penCap,t.stroke(),t.closePath(),n&&L.push({lx:e[r].lx,ly:e[r].ly,mx:e[r].mx,my:e[r].my}))}function w(){parseFloat((/CPU.+OS ([0-9_]{3}).*AppleWebkit.*Mobile/i.exec(navigator.userAgent)||[0,"4_2"])[1].replace("_","."))<4.1&&(e.fn.Oldoffset=e.fn.offset,e.fn.offset=function(){var t=e(this).Oldoffset();return t.top-=window.scrollY,t.left-=window.scrollX,t}),e(S.typed,x).bind("selectstart.signaturepad",function(t){return e(t.target).is(":input")}),T.bind("selectstart.signaturepad",function(t){return e(t.target).is(":input")}),!N.getContext&&FlashCanvas&&FlashCanvas.initElement(N),N.getContext&&(C=N.getContext("2d"),e(S.sig,x).show(),S.displayOnly||(S.drawOnly||(e(S.name,x).bind("keyup.signaturepad",function(){v(e(this).val())}),e(S.name,x).bind("blur.signaturepad",function(){v(e(this).val())}),e(S.drawIt,x).bind("click.signaturepad",function(e){e.preventDefault(),p()})),S.drawOnly||"drawIt"===S.defaultAction?p():d(),S.validateFields&&(e(t).is("form")?e(t).bind("submit.signaturepad",function(){return y()}):e(t).parents("form").bind("submit.signaturepad",function(){return y()})),e(S.sigNav,x).show()))}var E=this,S=e.extend({},e.fn.signaturePad.defaults,n),x=e(t),T=e(S.canvas,x),N=T.get(0),C=null,k={x:null,y:null},L=[],A=!1,O=!1,M=!1,_=!1,D=30,P=D,H=0;e.extend(E,{signaturePad:"2.5.1",init:function(){w()},updateOptions:function(t){e.extend(S,t)},regenerate:function(t){E.clearCanvas(),e(S.typed,x).hide(),"string"==typeof t&&(t=JSON.parse(t)),b(t,C,!0),S.output&&e(S.output,x).length>0&&e(S.output,x).val(JSON.stringify(L))},clearCanvas:function(){a()},getSignature:function(){return L},getSignatureString:function(){return JSON.stringify(L)},getSignatureImage:function(){var e=document.createElement("canvas"),t=null,n=null;return e.style.position="absolute",e.style.top="-999em",e.width=N.width,e.height=N.height,document.body.appendChild(e),!e.getContext&&FlashCanvas&&FlashCanvas.initElement(e),t=e.getContext("2d"),t.fillStyle=S.bgColour,t.fillRect(0,0,N.width,N.height),t.lineWidth=S.penWidth,t.strokeStyle=S.penColour,b(L,t),n=e.toDataURL.apply(e,arguments),document.body.removeChild(e),e=null,n},validateForm:function(){return y()}})}e.fn.signaturePad=function(n){var r=null;return this.each(function(){e.data(this,"plugin-signaturePad")?(r=e.data(this,"plugin-signaturePad"),r.updateOptions(n)):(r=new t(this,n),r.init(),e.data(this,"plugin-signaturePad",r))}),r},e.fn.signaturePad.defaults={defaultAction:"typeIt",displayOnly:!1,drawOnly:!1,canvas:"canvas",sig:".sig",sigNav:".sigNav",bgColour:"#ffffff",penColour:"#145394",penWidth:2,penCap:"round",lineColour:"#ccc",lineWidth:2,lineMargin:5,lineTop:35,name:".name",typed:".typed",clear:".clearButton",typeIt:".typeIt a",drawIt:".drawIt a",typeItDesc:".typeItDesc",drawItDesc:".drawItDesc",output:".output",currentClass:"current",validateFields:!0,errorClass:"error",errorMessage:"Please sign the document",errorMessageDraw:"Please sign the document",onBeforeValidate:null,onFormError:null,onDraw:null,onDrawEnd:null}}(jQuery)